.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_plot_custom_model.py>`     to download the full example code
    .. rst-class:: sphx-glr-example-title

    .. _sphx_glr_auto_examples_plot_custom_model.py:


Adding Custom Models for ADC Analysis
=====================================

This example will guide you throw defining and using a custom model for ADC analysis.

In order to add a new model, we can inherit from :class:`trait2d.analysis.models.ModelBase`.


.. code-block:: default


    from trait2d.analysis.models import ModelBase








Here, we define a simple model for Brownian diffusion (which is the same as the one already provided with the library).
You need to provide default values for the model parameter bounds and initial values as well as the model formula inside the ``__call__`` method.
You can also access ``R`` (point scanning across the field of view) and ``dt`` (time interval between track localisations) which are defined in the base class.


.. code-block:: default


    import numpy as np

    class ModelBrownian(ModelBase):
        lower = [0.0, 0.0]
        upper = [np.inf, np.inf]
        initial = [0.5e-12, 2.0e-9]

        def __call__(self, t, D, delta):
            return D+delta**2/(2*t*(1-2*self.R*self.dt/t))








After we've defined the model, we can simply add it to the :class:`trait2d.analysis.ModelDB`.


.. code-block:: default


    from trait2d.analysis import ModelDB
    ModelDB().add_model(ModelBrownian)








We can now run ADC analysis with the model.


.. code-block:: default


    from trait2d.analysis import Track
    track = Track.from_file("track1.csv", unit_length='micrometres')
    track.adc_analysis(fraction_fit_points = 0.15)
    track.plot_adc_analysis_results()




.. image:: /auto_examples/images/sphx_glr_plot_custom_model_001.png
    :alt: Diffusion Category: ModelBrownian
    :class: sphx-glr-single-img





It is a good idea to use `ModelDB().cleanup()` at the end of your notebooks to remove all models again. Otherwise they may carry over into other open notebooks.


.. code-block:: default


    ModelDB().cleanup()







.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.300 seconds)


.. _sphx_glr_download_auto_examples_plot_custom_model.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_custom_model.py <plot_custom_model.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_custom_model.ipynb <plot_custom_model.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
